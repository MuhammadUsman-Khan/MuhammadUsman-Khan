name: Generate Contribution Graph

on:
  schedule:
    - cron: "0 0 * * *" # Runs daily at 00:00 UTC
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Needed for Git commit & push

      # 2️⃣ Setup Node (required by lowlighter plugin)
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      # 3️⃣ Generate GitHub contribution SVG
      - name: Generate Contribution Graph SVG
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          user: MuhammadUsman-Khan
          template: classic
          base: ""
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          config_timezone: Asia/Karachi
          config_display: large
          config_animations: false  # Disable animations for static SVG
          config_output: contribution-graph.svg  # Explicit output filename

      # 4️⃣ Configure Git
      - name: Setup Git
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

      # 5️⃣ Add and commit changes only if they exist
      - name: Commit contribution graph if changed
        run: |
          git add contribution-graph.svg
          if ! git diff --cached --quiet; then
            git commit -m "Update contribution graph"
            git push origin HEAD
          else
            echo "No changes to commit"
          fi
